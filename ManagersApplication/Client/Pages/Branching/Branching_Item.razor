@page "/Branching_Item/{RQID}/"



<div class="container-fluid bg-light">
    <!-- COLOR PALETTE -->
    <div class="card card-info">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fa fa-tag"></i>
                فرم قرارداد - شماره درخواست: @RQID - نام متقاضی: @Requster_Name
            </h3>

        </div>
        <div class="card-body">

            <Branching_Common RQID=@RQID></Branching_Common>

        </div>
        <!-- /.card-body -->
    </div>
    <!-- /.card -->
</div>

@*@RQID*@
<div class="container-fluid bg-light">
    <!-- COLOR PALETTE -->
    <div class="card card-info">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fa fa-tag"></i>
                قرارداد
            </h3>
        </div>
        <div class="card-body font">
            <div class=" col-lg-12 float-right">
                <div class="row col-lg-3 mb-2 float-right">
                    <div class="col-lg-6 col-7"> تاریخ قرارداد:</div>
                    <div class="col-lg-6 col-5">@_contract.Cont_Date </div>
                </div>
                <div class="row col-lg-3 mb-2 float-right">
                    <div class="col-lg-6 col-7">تاریخ صورت جلسه: </div>
                    <div class="col-lg-6 col-5">@_contract.View_Date </div>
                </div>
                <div class="row col-lg-3 mb-2 float-right">
                    <div class="col-lg-6 col-10">مهلت تعهدات متقاضی(روز): </div>
                    <div class="col-lg-6 col-2">@_contract.Resp_Inst_Equp </div>
                </div>
                <div class="row col-lg-3 mb-2 float-right">
                    <div class="col-lg-6 col-10">مهلت تعهدات شرکت(روز): </div>
                    <div class="col-lg-6 col-2">@_contract.Resp_Dlve_Powr </div>
                </div>
            </div>
            <div class="row col-lg-12 float-right mt-1">
                <div class="row col-lg-6 float-right">
                    <div class="col-lg-3 col-4"> تعهدات متقاضی: </div>
                    <div class="col-lg-8 col-8">
                        <textarea class="form-control">@_contract.Comt_Aplr </textarea>
                    </div>
                </div>

                <div class="row col-lg-6 float-right mt-1">
                    <div class="col-lg-3 col-4"> تعهدات شرکت: </div>
                    <div class="col-lg-8 col-8">
                        <textarea class="form-control">@_contract.Comt_Comp  </textarea>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.card-body -->
    </div>
    <!-- /.card -->
    <div class="row col-lg-12 ">
        <div class="row col-lg-6">
            <div class="col-lg-4 col-4"> دلیل عدم تایید: </div>
            <div class="col-lg-8 col-8"><textarea @bind=Desc class="form-control"></textarea> </div>
        </div>
         @* <div class="row col-lg-6 mt-2 mb-2 mr-4">
              <table class="table table-striped">
                <tr>
                    <th>ایجاد یا تغییر</th>
                    <th>نوع مشترک</th>
                    <th>نوع متقاضی</th>
                    <th>نوع انشعاب</th>
                    <th>موقعیت محل</th>
                    <th>چگونگی برق رسانی</th>
                    <th>تعداد</th>
                    <th class="td-width">نوع تقاضا</th>
                    <th class="td-width">نوع کاربری</th>
                    <th>آمپر</th>
                    <th>فاز</th>
                    <th>قدرت</th>
                    <th class="td-width">ولتاژ تحویلی</th>
                </tr>
                <tbody>
                    @foreach (var item in BranchItemList)
                    {
                        <tr>
                            @if (item.Gnrt == "1")
                            {
                                <td>جدید</td>
                            }
                            else
                            {
                                <td>تغییر</td>
                            }

                            @if (item.Serv_Type == "1")
                            {
                                <td>عادی</td>
                            }
                            else
                            {
                                <td>دیماندی</td>
                            }

                            <td> @item.Rqtt_Desc</td>

                            @if (item.Brnc_Type == "1")
                            {
                                <td>دائم</td>
                            }
                            else if (item.Brnc_Type == "2")
                            {
                                <td>آزاد</td>
                            }
                            else if (item.Brnc_Type == "3")
                            {
                                <td>حاشیه شهر</td>
                            }
                            else if (item.Brnc_Type == "4")
                            {
                                <td>آزاد به دائم</td>
                            }
                            else if (item.Brnc_Type == "5")
                            {
                                <td>فتوولتاییک</td>
                            }
                            else if (item.Brnc_Type == "6")
                            {
                                <td>غیر دائم</td>
                            }
                            <td> @item.Loct_Desc</td>

                            @if (item.Inst_Supr == "1")
                            {
                                <td>شرکت</td>
                            }
                            else if (item.Inst_Supr == "2")
                            {
                                <td>متقاضی</td>
                            }
                            else
                            {
                                <td>شبکه موجود</td>
                            }
                            <td>@item.Admn_Numb</td>

                            <td>@item.Rqtp_Desc</td>

                            @if (item.Use_Type == "1")
                            {
                                <td>خانگی</td>
                            }
                            else if (item.Use_Type == "2")
                            {
                                <td>عمومی</td>
                            }
                            else if (item.Use_Type == "3")
                            {
                                <td>کشاورزی</td>
                            }
                            else if (item.Use_Type == "4")
                            {
                                <td>صنعتی</td>
                            }
                            else if (item.Use_Type == "5")
                            {
                                <td>سایر مصارف</td>
                            }

                            <td>@item.Ampr</td>

                            <td>@item.Phas</td>

                            <td>@item.Powr</td>

                            @if (item.Volt_Type == "1")
                            {
                                <td>اولیه</td>
                            }
                            else if (item.Volt_Type == "2")
                            {
                                <td>ثانویه</td>
                            }
                        </tr>
                    }
                </tbody>
            </table>

          </div>*@
    </div>
    <div class="row col-lg-12 ">
        <div class="row col-lg-6 mt-2 mb-2 mr-4">
            <div class="col-lg-3 mt-2 col-sm-3 col-5">
                @*<button class="btn btn-block btn-primary bg-success-gradient text-center" @onclick="Confirm">تایید</button>*@
                <a href="#" class="btn btn-block btn-primary bg-success-gradient text-center" data-toggle="modal" data-target="#confirmModal">تایید</a>
            </div>
            <div class="col-lg-3 mt-2 col-sm-3 col-5">
                @*                <button class="btn btn-block btn-primary bg-danger-gradient text-center" @onclick="Reject">عدم تایید</button>*@
                <a href="#" class="btn btn-block btn-primary bg-danger-gradient text-center" data-toggle="modal" data-target="#rejectModal">عدم تایید</a>

            </div>
            <div class="col-lg-3 mt-2 col-sm-3 col-5">
                <button class="btn btn-block btn-primary bg-warning-gradient text-center" @onclick="Back">بازگشت</button>
            </div>
            <div class="col-lg-3 mt-2 col-sm-3 col-5">
                <button class="btn btn-block btn-primary bg-info-gradient text-center" @onclick="@(()=>Img_Dsiplay(@RQID))">مشاهده مدارک</button>
            </div>

        </div>
        @*</div>*@

    </div>
    <!-- confir mModal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">تایید درخواست</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h4>آیا از تایید درخواست مطمئن هستید؟</h4>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-block btn-primary bg-success-gradient text-center" @onclick="Confirm" data-dismiss="modal">بلی</button>
                    <button type="button" class="btn btn-block btn-primary bg-info-gradient text-center" data-dismiss="modal">خیر</button>
                </div>
            </div>
        </div>
    </div>
    <!-- reject mModal -->
    <div class="modal fade" id="rejectModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">عدم تایید درخواست</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h4>آیا از عدم تایید درخواست مطمئن هستید؟</h4>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-block btn-primary bg-danger-gradient text-center" @onclick="Reject" data-dismiss="modal">بلی</button>
                    <button type="button" class="btn btn-block btn-primary bg-info-gradient text-center" data-dismiss="modal">خیر</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row col-lg-8">
        <div class="col-lg-8 col-8"><label class="text-danger">@Result_Message</label> </div>
    </div>

</div>


@code {
    [Parameter]
    public string RQID { get; set; }

    public string Requster_Name { get; set; }

    [Parameter]
    public Contract_Item _contract { get; set; }
    [Parameter]
    public string regn_code { get; set; }

    public string Desc { get; set; }

    public List<string> lst { get; set; }

    public string Result_Message { get; set; }

    protected override async Task OnInitializedAsync()
    {
        _contract = new Contract_Item();
        //////////////////////////////////////////
        await Get_Requester_Name_Async();
        //////////////////////////////////////////
        await Get_AdmContract();
        //////////////////////////////////////////

    }
    private async Task Confirm()
    {
        var result = await Http.PostAsJsonAsync("api/Branching/ConfirmContractasync/", RQID);
        var res = await result.Content.ReadAsStringAsync();
        if (res == "0")
            Result_Message = "ثبت با موفقیت انجام شد";
        else
            Result_Message = "درخواست شرایط مورد نظر را ندارد";

    }

    private async Task Reject()
    {
        lst = new List<string>();
        lst.Add(RQID);
        lst.Add(Desc);
        var result = await Http.PostAsJsonAsync("api/Branching/RejectContractasync/", lst);
        var res = await result.Content.ReadAsStringAsync();
        if (res == "0")
            Result_Message = "ثبت با موفقیت انجام شد";
        else
            Result_Message = "درخواست شرایط مورد نظر را ندارد";
    }

    private void Back()
    {
        //NavigationManager.NavigateTo($"/Branching/{RQID}/");
        NavigationManager.NavigateTo($"/Branching/{Temp.username}/");
    }
    private void Img_Dsiplay(string RQID)
    {
        NavigationManager.NavigateTo($"Image_Display/{RQID.ToString()}/");
    }

    private async Task Get_Requester_Name_Async()
    {
        var result_name = await Http.PostAsJsonAsync("api/Branching/Get_Requester_Name_Async/", RQID);
        Requster_Name = await result_name.Content.ReadAsStringAsync();
        var result_name_json = JsonConvert.DeserializeObject<Branching_Item>(Requster_Name);
        Requster_Name = result_name_json.Requster_Name;
    }

    private async Task Get_AdmContract()
    {
        var contract_Item = await Http.PostAsJsonAsync("api/Branching/Get_AdmContract/", RQID);
        var data = await contract_Item.Content.ReadAsStringAsync();
        _contract = JsonConvert.DeserializeObject<Contract_Item>(data);
    }


}
